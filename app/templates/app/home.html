<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Chat App</title>
    <style>
        .country-select {
            width: 100%;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #2980b9, #3498db);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .chat-container {
            width: 400px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .chat-header {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            border-bottom: 2px solid #2c3e50;
        }

        .message-input {
            width: calc(100% - 30px);
            padding: 15px;
            border: none;
            outline: none;
            box-sizing: border-box;
            background-color: #ecf0f1;
            border-top: 1px solid #bdc3c7;
            font-size: 16px;
            margin: 0 15px;
            border-radius: 0 0 8px 8px;
        }

        .send-button {
            width: calc(100% - 30px);
            background-color: #3498db;
            color: #fff;
            padding: 15px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin: 0 15px 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .send-button:hover {
            background-color: #2980b9;
        }
    </style>
    <!-- Flag icons CSS -->
    {% comment %} <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css">

    <!-- Select2 CSS and JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script> {% endcomment %}


</head>
<body>
    {% comment %} document.getElementById('message-display').value = `Server: ${str_obj.count}\n${document.getElementById('message-display').value}`; {% endcomment %}

    <div class="chat-container">
        <div class="chat-header" style="text-transform:capitalize;">Professional Chat: {{ group }} Group</div>
        {% comment %} <select id="country-select" class="country-select"></select> {% endcomment %}

        <input type="text" class="message-input" id="message-input" placeholder="Type your message...">
        <button class="send-button" id="message-submit">Send</button>
    </div>

    <div class="chat-container">
        <div class="chat-header">Server Messages</div>
        <textarea class="message-input" rows="6" col="100" id="message-display" placeholder="Server messages will appear here..." readonly>
          {% for chat in chats %}
            {{chat.content}}
        {% endfor %} 


        </textarea>
    </div>
    {{group|json_script:"Chat_group"}} 
    <script type="text/javascript">
    const Chat_Group = JSON.parse(document.getElementById("Chat_group").textContent);
    var ws = new WebSocket('ws://' +
    window.location.host +
    '/ws/asc/' +
    Chat_Group + 
    '/');
        console.log('Chat_Group')
        ws.onopen=function(event){
            console.log("Connection Established With WebSocket....",event)
            
        }
    
        ws.onmessage=function (event){
            console.log("Message Received from the server . . . ",event.data)
            console.log("Message Received from the server . . . ",typeof(event.data))
            const mesg_obj=JSON.parse(event.data)

            document.querySelector("#message-display").value += (mesg_obj.msg + '\n')

            console.log("h",(mesg_obj))
            console.log(typeof(mesg_obj))

        }
        
        ws.onerror=function(event){
            console.log("Error occurred in WebSocket",event)
        }
        
        ws.onclose=function(event){
            console.log("Closing the WebSocket ",event)
        }

    </script>
    <script>
         document.getElementById('message-submit').onclick=
         function(event) {
            const messageInputDom=document.getElementById('message-input')
            const message=messageInputDom.value
            ws.send(JSON.stringify({
                'msg':message
            }))
            messageInputDom.value=''
         }
    </script>
    {% comment %} <script>
        function populateCountrySelect() {
            const countrySelect = document.getElementById('country-select');
            const countries = [
                { code: 'us', name: 'United States' },
                { code: 'gb', name: 'United Kingdom' },
                // Add more countries as needed
            ];

            countries.forEach(country => {
                const option = new Option(country.name, country.code);
                $(option).data('flag', country.code.toLowerCase());

                countrySelect.append(option);
            });

            // Initialize Select2 for enhanced styling
            $('#country-select').select2({
                templateSelection: formatCountryOption,
                templateResult: formatCountryOption
            });
        }

        // Call the function to populate the country select field
        populateCountrySelect();

        // Function to format country options with flag icons
        function formatCountryOption(option) {
            if (!option.id) {
                return option.text;
            }

            const flagIcon = `<span class="flag-icon flag-icon-${$(option.element).data('flag')}"></span>`;
            return flagIcon + option.text;
        }
    </script> {% endcomment %}
</body>
</html>
